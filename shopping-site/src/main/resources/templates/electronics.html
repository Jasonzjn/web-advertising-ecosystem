<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电子产品 - 购物网站</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .ad-container {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .ad-image {
            max-width: 100%;
            height: auto;
        }
        .product-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            transition: box-shadow 0.3s;
        }
        .product-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .product-type-badge {
            font-size: 0.75em;
            padding: 0.25em 0.5em;
            border-radius: 0.25rem;
            margin-left: 5px;
        }
        .sport-badge { background-color: #d4edda; color: #155724; }
        .electronic-badge { background-color: #cce5ff; color: #004085; }
        .clothing-badge { background-color: #f8d7da; color: #721c24; }
        .food-badge { background-color: #fff3cd; color: #856404; }
        .cart-count {
            position: relative;
        }
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" th:text="${websiteName}">购物网站</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/products">商品</a>
            <a class="nav-link" href="/type/SPORT">运动</a>
            <a class="nav-link active" href="/type/ELECTRONIC">电子</a>
            <a class="nav-link" href="/type/CLOTHING">服装</a>
            <a class="nav-link" href="/type/FOOD">食品</a>
            <a class="nav-link cart-count" href="/cart">购物车
                <span class="cart-badge" id="cart-count" th:if="${cart != null}" th:text="${cart.totalItems > 0} ? ${cart.totalItems} : ''"></span>
            </a>
            <a class="nav-link" href="#">我的账户</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h1>电子产品</h1>

    <div class="row">
        <div class="col-md-8">
            <div class="row">
                <div class="col-md-4" th:each="product : ${products}">
                    <div class="product-card">
                        <img th:src="${product.imageUrl}" class="card-img-top" alt="商品图片" th:onerror="'https://via.placeholder.com/200'">
                        <h5 th:text="${product.name}">商品名称</h5>
                        <p class="text-muted" th:text="'¥' + ${product.price}">¥0.00</p>
                        <p th:text="${product.description}">商品描述</p>
                        <div>
                            <span class="product-type-badge electronic-badge">电子</span>
                        </div>
                        <button class="btn btn-primary mt-2" th:attr="data-product-id=${product.id}">加入购物车</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <h3>广告位</h3>
            <div id="ads-container">
                <!-- 广告将通过JavaScript加载 -->
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // 从广告API获取广告数据
    fetch('/api/ads')
        .then(response => response.json())
        .then(ads => {
            const container = document.getElementById('ads-container');
            if(ads && ads.length > 0) {
                ads.forEach(ad => {
                    const adElement = document.createElement('div');
                    adElement.className = 'ad-container';
                    adElement.innerHTML = `
                            <a href="${ad.targetUrl}" target="_blank">
                                <img src="${ad.imageUrl}" alt="${ad.title}" class="ad-image">
                                <h5>${ad.title}</h5>
                                <p>${ad.content}</p>
                            </a>
                        `;
                    container.appendChild(adElement);
                });
            } else {
                container.innerHTML = '<p>暂无广告</p>';
            }
        })
        .catch(error => {
            console.error('获取广告失败:', error);
            document.getElementById('ads-container').innerHTML = '<p>广告加载失败</p>';
        });

    // 添加到购物车功能
    document.querySelectorAll('.btn-primary').forEach(button => {
        if (!button.classList.contains('btn-primary') || button.closest('a')) return; // 跳过链接按钮

        button.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            if (!productId) return; // 跳过没有data-product-id属性的按钮

            fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `productId=${productId}&quantity=1`
            })
                .then(response => response.text())
                .then(data => {
                    // 更新购物车计数
                    const cartCount = document.getElementById('cart-count');
                    cartCount.textContent = data;
                    cartCount.style.display = data > 0 ? 'block' : 'none';

                    // 显示添加成功提示
                    alert('商品已添加到购物车！');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('添加到购物车失败，请重试。');
                });
        });
    });
</script>
</body>
</html>